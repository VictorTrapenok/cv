<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://viktor-t.com/blog</id>
    <title>I'm searching new remote job Blog</title>
    <updated>2024-10-15T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://viktor-t.com/blog"/>
    <subtitle>I'm searching new remote job Blog</subtitle>
    <icon>https://viktor-t.com/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Reducing CI/CD infrastructure costs]]></title>
        <id>https://viktor-t.com/blog/karpenter-for-gitlabrunner</id>
        <link href="https://viktor-t.com/blog/karpenter-for-gitlabrunner"/>
        <updated>2024-10-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I want to share how we at Nanoheal reduced our infrastructure costs by using GitLab runners in Kubernetes with Karpenter on spot instances.]]></summary>
        <content type="html"><![CDATA[<p>I want to share how we at Nanoheal reduced our infrastructure costs by using GitLab runners in Kubernetes with Karpenter on spot instances.</p>
<p>At Nanoheal, we have a high level of developer activity, and CI/CD pipelines runs a critical role in our DevOps practices for continuous delivery.</p>
<p>Previously, we ran three powerful EC2 virtual machines in our AWS account, dedicated to hosting GitLab runners. However, since our team worked within the same time zone, these machines sat idle almost 16 hours per day, as most work was done during business hours. During the remaining 8 hours, the servers were often overloaded due to peak demand.</p>
<h1>The Solution</h1>
<p>I migrated GitLab runners to Kubernetes. We already had a Kubernetes cluster running in AWS, so I configured Karpenter to handle autoscaling within the cluster.</p>
<p>Karpenter uses taints and node affinity rules to determine on which nodes specific pods should run.</p>
<p>The configuration is set up so that Karpenter creates a node when a GitLab runner starts a pipeline. Then pipeline runs on a spot instance, specifically dedicated for CI/CD tasks. Our pipelines consume a significant amount of resources and can negatively impact other services if they share the same node in the cluster.</p>
<p>Once the pipeline completes, the node remains empty, thanks to the properly configured taints, which prevent other pods from being scheduled on it. After 30 minutes of inactivity, Karpenter automatically removes the node.</p>
<h1>The Result</h1>
<p>By migrating CI/CD pipelines to our Kubernetes cluster, we eliminated the need for three always-on virtual machines. Instead, we now run 1â€“2 spot nodes in the cluster, running ~60 hours per week, drastically cutting down our infrastructure costs.</p>
<p>You can get <a href="https://github.com/VictorTrapenok/karpenter-for-gitlabrunner" target="_blank" rel="noopener noreferrer">configuration files in my github</a></p>
<ul>
<li>Helm chart for gitlab runner: <a href="https://gitlab.com/gitlab-org/charts/gitlab-runner" target="_blank" rel="noopener noreferrer">gitlab-runner</a></li>
<li>karpenter autoscaller: <a href="https://karpenter.sh/" target="_blank" rel="noopener noreferrer">karpenter</a></li>
<li>karpenter configuration <a href="https://github.com/VictorTrapenok/karpenter-for-gitlabrunner/blob/main/karpenter-coniguration.yaml" target="_blank" rel="noopener noreferrer">karpenter-coniguration.yaml</a></li>
</ul>
<h1>Any help?</h1>
<p>Please ping me in <a href="https://www.linkedin.com/in/victor-trapenok/" target="_blank" rel="noopener noreferrer">linkedin</a> if you need any help. I am open to work.</p>]]></content>
        <author>
            <name>Viktor Trapenok</name>
            <uri>https://www.linkedin.com/in/victor-trapenok/</uri>
        </author>
        <category label="Karpenter" term="Karpenter"/>
        <category label="GitLab" term="GitLab"/>
        <category label="Kubernetes" term="Kubernetes"/>
    </entry>
</feed>